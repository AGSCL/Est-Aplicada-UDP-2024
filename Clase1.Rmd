---
title: "Clase 1"
author: "Andrés González"
date:  "`r withr::with_locale(new =c('LC_TIME' = 'es_ES'), code =format(Sys.time(),'%B %d, %Y'))`"
encoding: utf-8
output:
  xaringan::moon_reader:
    includes:
      after_body: ['mylibs/collapseoutput.js','mylibs/zoom.html', 'mylibs/timer.html']
    transition: slide
    lib_dir: libs
    css: ['animate.min.css', 'ninjutsu']
    self_contained: true # if true, fonts will be stored locally
    seal: false # show a title slide with YAML information
    nature:
      countdown: 90000 #60 segundos *2
      highlightStyle: github
      highlightLines: true # {{}} o * los pondrá como muy importantes  para destacar: # <<
      slideNumberFormat: '%current%'
      countIncrementalSlides: false
      ratio: '16:9' # alternatives '16:9' or '4:3' or others e.g. 13:9
      navigation:
        scroll: false # disable slide transitions by scrolling
---
class: title-slide, middle, right 

<meta http-equiv='Content-Type' content='text/html; charset=utf-8' />

```{css hideOutput-lib-src, echo = FALSE}
<style>
/* Oculta los bloques de código con la clase 'r' */
pre.r {
  display: none !important;
}
</style>

<script>
doclick = function(e) {
  // Busca el siguiente bloque de código con la clase 'r'
  code = e.parentNode.nextSibling.nextSibling;

  if (code.style.display == "block") {
    code.style.display = 'none';
    e.textContent = "Mostrar código";
  } else {
    code.style.display = "block";
    e.textContent = "Ocultar código";
  }
}
</script>

<script>
function myFunction1() {
    var x = document.getElementById("myDIV");
    if (x.style.display === "none") {
        x.style.display = "block";
    } else {
        x.style.display = "none";
    }
}
</script>

<script>
function myFunction2() {
    var x = document.getElementById("myDIV2");
    if (x.style.display === "none") {
        x.style.display = "block";
    } else {
        x.style.display = "none";
    }
}
</script>
```
```{css, echo = F}
/* -------------------------------------------------------
 *
 *     !! This file was generated by xaringanthemer !!
 *
 *  Changes made to this file directly will be overwritten
 *  if you used xaringanthemer in your xaringan slides Rmd
 *
 *  Issues or likes?
 *    - https://github.com/gadenbuie/xaringanthemer
 *    - https://www.garrickadenbuie.com
 *
 *  Need help? Try:
 *    - vignette(package = "xaringanthemer")
 *    - ?xaringanthemer::style_xaringan
 *    - xaringan wiki: https://github.com/yihui/xaringan/wiki
 *    - remarkjs wiki: https://github.com/gnab/remark/wiki
 *
 *  Version: 0.4.1
 *
 * ------------------------------------------------------- */
@import url(https://fonts.googleapis.com/css?family=Lato:400,400i&display=swap);
@import url(https://fonts.googleapis.com/css?family=Lato&display=swap);
@import url(https://fonts.googleapis.com/css?family=Lato&display=swap);
@import url(https://fonts.googleapis.com/css?family=Arial+Narrow&display=swap);

:root {
  /* Fonts */
  --text-font-family: Lato;
  --text-font-is-google: 1;
  --text-font-family-fallback: -apple-system, BlinkMacSystemFont, avenir next, avenir, helvetica neue, helvetica, Ubuntu, roboto, noto, segoe ui, arial;
  --text-font-base: sans-serif;
  --header-font-family: Lato;
  --header-font-is-google: 1;
  --header-font-family-fallback: Georgia, serif;
  --code-font-family: Lato;
  --code-font-is-google: 1;
  --base-font-size: 20px;
  --text-font-size: 1rem;
  --code-font-size: 53%;
  --code-inline-font-size: 1em;
  --header-h1-font-size: 2.75rem;
  --header-h2-font-size: 2.25rem;
  --header-h3-font-size: 1.75rem;

  /* Colors */
  --text-color: #333333;
  --header-color: #DD3333;
  --background-color: #FFFFFF;
  --link-color: #DD3333;
  --text-bold-color: #FF5252;
  --code-highlight-color: rgba(255,255,0,0.5);
  --inverse-text-color: #FFFFFF;
  --inverse-background-color: #DD3333;
  --inverse-header-color: #FFFFFF;
  --inverse-link-color: #DD3333;
  --title-slide-background-color: #FFFFFF;
  --title-slide-text-color: #DD3333;
  --header-background-color: #DD3333;
  --header-background-text-color: #FFFFFF;
  --primary: #FFFFFF;
  --secondary: #DD3333;
}

html {
  font-size: var(--base-font-size);
}

body {
  font-family: var(--text-font-family), var(--text-font-family-fallback), var(--text-font-base);
  font-weight: 400;
  color: var(--text-color);
}
h1, h2, h3 {
  font-family: var(--header-font-family), var(--header-font-family-fallback);
  font-weight: 600;
  color: var(--header-color);
}
.remark-slide-content {
  background-color: var(--background-color);
  font-size: 1rem;
  padding: 0.4em 2.4em 0.4em 2.4em;
  width: 100%;
  height: 100%;
}
.remark-slide-content h1 {
  font-size: var(--header-h1-font-size);
}
.remark-slide-content h2 {
  font-size: var(--header-h2-font-size);
}
.remark-slide-content h3 {
  font-size: var(--header-h3-font-size);
}
.remark-code, .remark-inline-code {
  font-family: var(--code-font-family), Menlo, Consolas, Monaco, Liberation Mono, Lucida Console, monospace;
}
.remark-code {
  font-size: var(--code-font-size);
}
.remark-inline-code {
  font-size: var(--code-inline-font-size);
  color: #DD3333;
}
.remark-slide-number {
  color: #333333;
  opacity: 1;
  font-size: 0.9rem;
}
strong {
  font-weight: bold;
  color: var(--text-bold-color);
}
a, a > code {
  color: var(--link-color);
  text-decoration: none;
}
.footnote {
  position: absolute;
  bottom: 60px;
  padding-right: 4em;
  font-size: 0.9em;
}
.remark-code-line-highlighted {
  background-color: var(--code-highlight-color);
}
.inverse {
  background-color: var(--inverse-background-color);
  color: var(--inverse-text-color);
  
}
.inverse h1, .inverse h2, .inverse h3 {
  color: var(--inverse-header-color);
}
.inverse a, .inverse a > code {
  color: var(--inverse-link-color);
}
.title-slide, .title-slide h1, .title-slide h2, .title-slide h3 {
  color: var(--title-slide-text-color);
}
.title-slide {
  background-color: var(--title-slide-background-color);
}
.title-slide .remark-slide-number {
  display: none;
}
/* Two-column layout */
.left-column {
  width: 20%;
  height: 92%;
  float: left;
}
.left-column h2, .left-column h3 {
  color: #DD333399;
}
.left-column h2:last-of-type, .left-column h3:last-child {
  color: #DD3333;
}
.right-column {
  width: 75%;
  float: right;
  padding-top: 1em;
}
.pull-left {
  float: left;
  width: 47%;
}
.pull-right {
  float: right;
  width: 47%;
}
.pull-right + * {
  clear: both;
}
img, video, iframe {
  max-width: 100%;
}
blockquote {
  border-left: solid 5px #DD333380;
  padding-left: 1em;
}
.remark-slide table {
  margin: auto;
  border-top: 1px solid #666;
  border-bottom: 1px solid #666;
}
.remark-slide table thead th {
  border-bottom: 1px solid #ddd;
}
th, td {
  padding: 5px;
}
.remark-slide thead, .remark-slide tfoot, .remark-slide tr:nth-child(even) {
  background: #FFFFFF;
}
table.dataTable tbody {
  background-color: var(--background-color);
  color: var(--text-color);
}
table.dataTable.display tbody tr.odd {
  background-color: var(--background-color);
}
table.dataTable.display tbody tr.even {
  background-color: #FFFFFF;
}
table.dataTable.hover tbody tr:hover, table.dataTable.display tbody tr:hover {
  background-color: rgba(255, 255, 255, 0.5);
}
.dataTables_wrapper .dataTables_length, .dataTables_wrapper .dataTables_filter, .dataTables_wrapper .dataTables_info, .dataTables_wrapper .dataTables_processing, .dataTables_wrapper .dataTables_paginate {
  color: var(--text-color);
}
.dataTables_wrapper .dataTables_paginate .paginate_button {
  color: var(--text-color) !important;
}

/* Horizontal alignment of code blocks */
.remark-slide-content.left pre,
.remark-slide-content.center pre,
.remark-slide-content.right pre {
  text-align: start;
  width: max-content;
  max-width: 100%;
}
.remark-slide-content.left pre,
.remark-slide-content.right pre {
  min-width: 50%;
  min-width: min(40ch, 100%);
}
.remark-slide-content.center pre {
  min-width: 66%;
  min-width: min(50ch, 100%);
}
.remark-slide-content.left pre {
  margin-left: unset;
  margin-right: auto;
}
.remark-slide-content.center pre {
  margin-left: auto;
  margin-right: auto;
}
.remark-slide-content.right pre {
  margin-left: auto;
  margin-right: unset;
}

/* Slide Header Background for h1 elements */
.remark-slide-content.header_background > h1 {
  display: block;
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  background: var(--header-background-color);
  color: var(--header-background-text-color);
  padding: 2rem 2.4em 1.5rem 2.4em;
  margin-top: 0;
  box-sizing: border-box;
}
.remark-slide-content.header_background {
  padding-top: 7rem;
}

@page { margin: 0; }
@media print {
  .remark-slide-scaler {
    width: 100% !important;
    height: 100% !important;
    transform: scale(1) !important;
    top: 0 !important;
    left: 0 !important;
  }
}

.primary {
  color: var(--primary);
}
.bg-primary {
  background-color: var(--primary);
}
.secondary {
  color: var(--secondary);
}
.bg-secondary {
  background-color: var(--secondary);
}

/* Extra CSS */
.remark-slide-scaler {
  overflow-y: auto;
}
.gray {
  color: #aaaaaa;
}
.black {
  color: #bc7777;
}
.darkgreen {
  color: #45503B;
}
.darkred {
  color: #591F0A;
}
.small {
  font-size: 90%;
}
.pull_c {
  float: center;
  width: 30%;
  height: 50%;
  padding-left: 40%;
}
.pull_c_title {
  height: 90%;
}
.pull_l_70 {
  float: left;
  width: 72%;
  font-size: 90%;
}
.pull_r_30 {
  float: right;
  width: 23%;
  font-size: 90%;
}
.pull_left {
  float: left;
  width: 47%;
  height: 100%;
  padding-right: 2%;
}
.pull_right {
  float: right;
  width: 47%;
  height: 100%;
  padding-left: 2%;
}
.small_left {
  float: left;
  width: 47%;
  height: 50%;
  padding-right: 2%;
}
.small_right {
  float: right;
  width: 47%;
  height: 50%;
  padding-left: 2%;
}
.left_code {
  float: left;
  width: 47%;
  height: 100%;
  padding-right: 2%;
  font: Roboto;
}
.code_out {
  float: right;
  width: 47%;
  height: 100%;
  padding-left: 2%;
  font: Roboto;
}
.text_180 {
  font-size: 180%;
}
.text_170 {
  font-size: 170%;
}
.text_160 {
  font-size: 160%;
}
.text_150 {
  font-size: 150%;
}
.text_140 {
  font-size: 140%;
}
.text_130 {
  font-size: 130%;
}
.text_120 {
  font-size: 120%;
}
.text_110 {
  font-size: 110%;
}
.text_110 {
  font-size: 110%;
}
.text_100 {
  font-size: 100%;
}
.code_10 {
  code-inline-font-size: 60%;
  overflow-y: scroll !important;
  overflow-x: scroll !important;
  max-height: 5vh !important;
  line-height: 0.75em;
}
.code_10_pre {
  code-inline-font-size: 60%;
  overflow-y: scroll !important;
  overflow-x: scroll !important;
  max-height: 15vh !important;
  line-height: 0.75em;
  min-height: 0.5em;
}
.code_15 {
  code-inline-font-size: 15%;
  overflow-y: scroll !important;
  overflow-x: scroll !important;
  max-height: 10vh !important;
}
.text_90 {
  font-size: 90%;
}
.text_80 {
  font-size: 80%;
}
.text_70 {
  font-size: 70%;
}
.text_65 {
  font-size: 65%;
}
.text_60 {
  font-size: 60%;
}
.text_50 {
  font-size: 50%;
}
.text_40 {
  font-size: 40%;
}
.text_30 {
  font-size: 30%;
}
.text_20 {
  font-size: 20%;
}
.line_space_15 {
  line-height: 1.5em;;
}
.line_space_13 {
  line-height: 1.3em;;
}
.line_space_11 {
  line-height: 1.1em;;
}
.line_space_15 {
  line-height: 1.5em;;
}
.line_space_09 {
  line-height: 0.9em;;
}
.line_space_07 {
  line-height: 0.7em;;
}
.line_space_05 {
  line-height: 0.5em;;
}
.largest {
  font-size: 2.488em;;
}
.larger {
  font-size: 2.074em;;
}
.large {
  font-size: 1.44em;;
}
.small {
  font-size: 0.833em;;
}
.smaller {
  font-size: 0.694em;;
}
.smallest {
  font-size: 0.579em;;
}
.limity150 {
  max-height: 150px;;
  overflow-y: auto;;
}
.tiny_text {
  font-size: 70%;
}
.large_text {
  font-size: 150%;
}
.slide_blue {
  background-color: #FEDA3F;
  color: #3C3C3B;
}
.center_image {
  margin: 0;
  position: absolute;
  top: 50%;
  left: 50%;
  -ms-transform: translate(-50%, -50%);
  transform: translate(-50%, -50%);
}
.center_left_img {
  top: 50%;
  left: 35%;
}
.center_left_image {
  margin: 0;
  position: absolute;
  top: 50%;
  left: 35%;
  -ms-transform: translate(-50%, -50%);
  transform: translate(-50%, -50%);
}
.center_down_image {
  margin: 0;
  position: absolute;
  top: 90%;
  left: 50%;
  -ms-transform: translate(-50%, -50%);
  transform: translate(-50%, -50%);
}
.center_top_image {
  margin: 0;
  position: absolute;
  top: 10%; /* Adjust to place the image at the top */
  left: 50%;
  -ms-transform: translate(-50%, -50%);
  transform: translate(-50%, -50%);
}
slides > slide {
  overflow-x: auto !important;
  overflow-y: auto !important;
}
.superbigimage {
  white-space: nowrap;
  overflow-y: scroll;
}
```

```{r setup_theme0, include = FALSE}
rm(list=ls());gc()
if(!grepl("4.4.0",R.version.string)){stop("Versión diferente (debe ser 4.4.0)")}
pacman::p_unlock(lib.loc = .libPaths()) #para no tener problemas reinstalando paquetes

if(!require(devtools)){install.packages("devtools", type = "win.binary", dependencies=T)}

options(servr.daemon = TRUE)
```

```{cat, engine.opts=list(file = "mylibs/zoom.html"), include=F}
<script src="https://lab.hakim.se/zoom-js/js/zoom.js" type="text/javascript"></script>
<script type="text/javascript">
	slideshow.on( "beforeHideSlide", function( slide ) {
		zoom.out();
	} );
	slideshow.on( "afterShowSlide", function( slide ) {
		document.querySelector( ".remark-visible" ).addEventListener( "dblclick", function( event ) {
			event.preventDefault();
			zoom.to( {element: event.target} );
		} );
	} );
</script>
```

```{r setup, include = FALSE}
#Para bajar paquetes estadísticos
source("___requirements.txt")

if(!require(ggwordcloud)){install.packages("ggwordcloud")}
#if(!require(sentiment.ai)){install.packages("sentiment.ai")}
if(!require(SentimentAnalysis)){install.packages("SentimentAnalysis")}
if(!require(sentimentr)){install.packages("sentimentr")}
if(!require(tidytext)){install.packages("tidytext")}
if(!require(tm)){install.packages("tm")}
if(!require(gridExtra)){install.packages("gridExtra")}

#ve si existe el emoticon de github, sino lo baja
test_fontawesome<- function(x="github"){
tryCatch({
  invisible(fontawesome::fa(name = x))
  return(message("fontawesome installed"))
},
# ... but if an error occurs, tell me what happened: 
error=function(error_message) {
  message("Installing fontawesome")
  icons::download_fontawesome()  
})
}

options(htmltools.preserve.raw = FALSE)


#knitr::opts_chunk$set(comment = NA) # lo saqué pa probar por si
knitr::opts_chunk$set(dpi=720)
#options(htmltools.preserve.raw = FALSE)#A recent update to rmarkdown (in version 2.6) changed how HTML widgets are included in the output file to use pandoc's raw HTML blocks. Unfortunately, this feature isn't compatible with the JavaScript markdown library used by xaringan. You can disable this feature and resolve the issue with htmlwidgets in xaringan slides by setting
#https://stackoverflow.com/questions/65766516/xaringan-presentation-not-displaying-html-widgets-even-when-knitting-provided-t/65768952#65768952


xaringanExtra::use_progress_bar(color = "#12636B", location = "top")#, height = "550px")
xaringanExtra::use_animate_css()
xaringanExtra::use_scribble() #son los lapices
xaringanExtra::use_tile_view()
xaringanExtra::use_panelset()
xaringanExtra::use_editable(expires = 1)
xaringanExtra::use_fit_screen()

#https://gist.github.com/gadenbuie/61b27108ceec6c7a55cd9966609128d7

# padding-top: 0.4em;
# padding-right: 2.4em;
# padding-bottom: 0.4em;
# padding-left: 2.4em;
invisible("https://www.youtube.com/watch?v=M3skTMQbCD0")
invisible("https://zane.lol/slides/adirondack/#39")
#https://titanwolf.org/Network/Articles/Article?AID=3896fe2c-1b3b-4ebd-9906-1f9ed1675b35#gsc.tab=0
#https://annakrystalli.me/talks/xaringan/xaringan.html#55
#https://bookdown.org/yihui/rmarkdown/some-tips.html
#https://arm.rbind.io/slides/xaringan.html#90
#https://stackoverflow.com/questions/62069400/font-size-of-figure-in-xaringan-slide-too-small
#https://irene.vrbik.ok.ubc.ca/blog/2021-07-14-xaringan-slides/

#https://evamaerey.github.io/doublecrochet/
check_code <- function(expr, available){
  if(available){
    eval(parse(text = expr))
  } else {
    expr
  }
}
path2<-dirname(rstudioapi::getSourceEditorContext()$path)
#knitr::opts_chunk$set(message = FALSE,warning = FALSE, error = FALSE)

```

<br> 
 
.line_space_15[ 
## .text_80[Estadística Aplicada y <br> Procesamiento de Datos con R]
]

<br>

.line_space_11[
    
<br>

.text_70[[Código en: `r fontawesome::fa(name = "github")`](https://github.com/AGSCL/Curso_UDP)]

.text_110[Clase 1. Proyectos en R]

]


.bg-text[


`r withr::with_locale(new = c('LC_TIME' = 'es_ES'), code =format(Sys.time(),'%d de %B, %Y'))`



.text_100[Andrés González Santa Cruz]
.text_65[andres.gonzalezs@mail.udp.cl] [`r fontawesome::fa(name = "github")`](https://github.com/AGSCL) [`r fontawesome::fa(name = "orcid", fill="green")`](https://orcid.org/0000-0002-5166-9121)
]

.text_100[José Ruiz-Tagle Maturana]
.text_65[jose.ruiz-tagle@mail.udp.cl] [`r fontawesome::fa(name = "orcid", fill="green")`](https://orcid.org/0000-0002-4866-5701)

<br>
  
```{r echo=FALSE, out.width = '15%'}
knitr::include_graphics('./_style/cropped-logotipo_fsch.png')
```

???
*#_#_#_#_#_#_#_#_#_#_
**NOTA**
*#_#_#_#_#_#_#_#_#_#_

- Mi nombre es andrés gonzález. Soy asistente de investigación de un proyecto milenio de políticas sobre drogas y trabajo para Alvaro Castillo en el Centro de Investigación en Sociedad y Salud de la Universidad Mayor. También estudio un doctorado en Salud pública en la Universidad de Chile
- Mi nombre es José Ruiz-Tagle, 

- Ustedes: Nombre, nivel de manejo en R, experiencias previas con este software , manejo informático, expectativas
- Es de carácter introductorio a R y Rstudio
- No es un curso de estadística ni de programación funcional
- No soy un experto en informática ni en estadística
- Es un curso enfocado a la aplicación de herramientas básicas de gestión de datos en R y Rstudio
- Brinda herramientas, guía y orientación para profundizar de manera individual
- PRESENTAR PROGRAMA

Reglas de convivencia
1. Cámaras prendidas y micrófono muteado.
2. Atención, participación y compromiso con las sesiones.
3. El respeto por el otro (y por su trabajo) se demuestra de muchas formas.
4. La pregunta más “tonta” es la que no se hace.

---
layout: true
class: animated, fadeIn
---
## Resumen

.pull_left[

.details-code[

```{r a, fig.align="center", message=FALSE, warning=FALSE, cache=T, eval=T, echo =T, out.width = "300px",  out.extra='style="font-size:80%; line-height:1.5;"'}
options(
  # whenever there is one account token found, use the cached token
  gargle_oauth_email = TRUE,
  # specify auth tokens should be stored in a hidden directory ".secrets"
  gargle_oauth_cache = "./_shiny/secrets"
)

library(readr)
encuesta_wide <- googlesheets4::read_sheet(googledrive::drive_get("encuesta_2024")$id) %>% 
  #cuento cuantas veces aparece
    dplyr::group_by(question_id) %>% 
  #genero una columna ID
    dplyr::mutate(ID=dplyr::row_number()) %>% 
  #guardamos la base original por si necesitamos despues revisarla
    assign("encuesta",.,envir = .GlobalEnv) %>%
  #dejo los datos en un formato ancho, en que cada ingreso de formulario (ID) es una fila, y conservamos la fila de preguntas.
    tidyr::pivot_wider(id_cols=c(ID), names_from= question_id, values_from= response) %>% 
  #en caso que alguien haya enviado más de una vez, me quedo con el último
  dplyr::ungroup() %>% 
  dplyr::group_by(a) %>% 
  dplyr::slice_tail() %>% 
  dplyr::ungroup() 

  #Etiquetas
  for (i in 1:length(unique(encuesta$PREGUNTAS))) {
    x<-i+1
  attributes(encuesta_wide)$variable.labels[x]<-  unique(encuesta$PREGUNTAS)[i]
  }

encuesta_wide %>% 
  dplyr::select(a) %>% 
  dplyr::ungroup() %>% 
  knitr::kable("markdown", caption="a.¿Cuál es su nombre completo?", col.names="Nombre")
```
]

.details-code[

```{r b-c, eval=T, echo=T, fig.align="center", message=FALSE, warning=FALSE, cache=TRUE, out.width="500px", results='hold'}
par(mfrow = c(1, 2), mar = c(5, 4, 4, 2) + 0.1)

require(ggplot2)
plotb<-
encuesta_wide %>%
    ggplot(aes(x=as.numeric(b)))+
    geom_histogram(bins=50)+
  ggtitle("Distribución años de experiencia usando R")+
  xlab("Años de experiencia en R")+ylab("Recuento")+
  theme_light(base_size=15)+
  # Agregar el texto con formato
  ggplot2::annotate("text", x = Inf, y = Inf, hjust = 1.1, vjust = 1.1,
           label = paste0("Media: ", round(mean(as.numeric(encuesta_wide$b),na.rm=T), 2), "\nDesviación estándar: ", round(sd(as.numeric(encuesta_wide$b),na.rm=T), 2)),
           family = "sans", size = 6)+
  theme(plot.margin = margin(5, 5, 5, 5))  # Reduce the margins

# Ajustar los márgenes para centrar mejor la nube de palabras

#[4] "d.¿Cuáles son sus expectativas del taller?"

corpus <- Corpus(VectorSource(encuesta_wide$d)) #

d  <- tm_map(corpus, tolower)
d  <- tm_map(d, stripWhitespace)
d <- tm_map(d, removePunctuation)
d <- tm_map(d, removeNumbers)
d <- tm_map(d, removeWords, stopwords("spanish"))
d <- tm_map(d, removeWords, "menos")
#d <- tm_map(d, removeWords, c("usted", "pues", "tal", "tan", "así", "dijo", "cómo", "sino", "entonces", "aunque", "don", "doña","hacia","mayor","algún","cada","tambien","ello","mostrara","sólo", "ser","tener","manera","actualmente","mejor","casos","trabajo","parte","contar",""))
tdm <- TermDocumentMatrix(d)
m <- as.matrix(tdm) #lo vuelve una matriz
v <- sort(rowSums(m),decreasing=TRUE) #lo ordena y suma
df <- data.frame(word = names(v),freq=v) # lo nombra y le da formato de data.frame

# Crear la nube de palabras
wordcloud_plot <- 
ggplot(df, aes(label = word, size = freq, color= freq)) +
    #area_corr hace que el tamaño sea un correlato del tamaño del texto y la figura
    ggwordcloud::geom_text_wordcloud_area() +
    # color de textos
    scale_color_gradient(low = "gray80", high = "gray10")+
    # máximo tamaño de 30  
    scale_size_area(max_size = 20) + 
    theme_minimal() +
  theme(plot.margin = margin(5, 5, 5, 5))  # Reduce the margins

##combinamos 
gridExtra::grid.arrange(plotb, wordcloud_plot, nrow = 2)
```
]
]

.pull_right[

.details-code[
.details-code[
```{r e, fig.align="center", include=FALSE, cache=F, eval=T, echo =T, out.width="100%"}
if(!require(plotly)){install.packages("plotly")}
#[5] "e.¿Qué aspecto de los contenidos le interesó más?"  

#introduce cada 13 caracteres un quiebre de línea en fotmato HTML
insert_line_breaks <- function(text, n = 13) {
  paste(strwrap(text, width = n), collapse = "<br>")
}
fig_plotly<-
data.frame(e = encuesta_wide$e) %>%
  dplyr::count(e) %>% 
  dplyr::mutate(
    e = sapply(e, insert_line_breaks),  
    valid_percent = scales::percent(n / (sum(n) - sum(n[is.na(e)])), 2),
    valid_percent = ifelse(is.na(n), NA, valid_percent),
    percent = scales::percent(n / sum(n), 2)
  ) %>% 
  dplyr::mutate(label = paste0(e, " n=", n, "<br>(", valid_percent, ")")) %>% 
  dplyr::ungroup() %>%
  dplyr::filter(!is.na(n)) %>% 
  plot_ly(
    labels = ~e, values = ~n, type = 'pie', hole = 0.3,
    textposition = 'outside',
    textinfo = 'text',
    text = ~label, 
    automargin = TRUE,
    sort = FALSE,
    direction = "clockwise",
    textfont = list(size = 13),
    marker = list(colors = c(gray.colors(length(unique(encuesta_wide$e))-1), "#FF5252"))
  ) %>%
  layout(
    yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = TRUE),
    xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = TRUE),
    showlegend = FALSE,
  #  width = 350, height = 350,
    margin = list(l = 0, r = 0, t = 0, b = 0),  # Reducir los márgenes
    paper_bgcolor = 'rgba(0,0,0,0)',  # Fondo transparente
    plot_bgcolor = 'rgba(0,0,0,0)'    # Fondo transparente del gráfico
  )

if(file.exists("Clase1_files/figure-html/widgets/widget_e2.html")){print("")}else{
saveWidget(as_widget(fig_plotly), file = '_figs/plotly_plot.html', selfcontained = T)
}
#si hay problemas con cargar paquetes, 
#debo eliminar la carpeta y cargarlo manualmente el savewidget
#esto ocurre porque se duplican carpetas en drive
```

```{r e2, echo=FALSE, fig.align='center', warning=F}
widgetframe::frameWidget(fig_plotly, height ="65%", width = "65%")#
```
]

.details-code[
```{r canvas, echo=T, message=T, error=T, eval=T}
try(token<- read.table(paste0(gsub("2024","",getwd()),"token2.txt"), quote='\"', comment.char=''))

rcanvas::set_canvas_token(as.character(token))

rcanvas::set_canvas_domain("https://udp.instructure.com/")

rcanvas::get_course_items(course_id = 26278, item = "users", include = "email") %>% #25422
  dplyr::select(id, short_name, email)  %>% 
  dplyr::mutate(email= tolower(email)) %>% 
  dplyr::filter(!short_name %in% c("JOSÉ RUIZ-TAGLE", "ANDRES GONZALEZ", "SEBASTIAN TRONCOSO")) %>%  #jrt
    knitr::kable("html", col.names = c("ID", "Nombre", "Correo")) %>% 
  kableExtra::kable_classic( )%>% 
  kableExtra::scroll_box(width = "100%", height = "275px") %>% 
      kableExtra::kable_styling(font_size = 10) %>%
    gsub("font-size: initial !important;", 
         "font-size: 8pt !important;", 
         .)
```
]
]
]



???
*#_#_#_#_#_#_#_#_#_#_
**NOTA**
*#_#_#_#_#_#_#_#_#_#_

]

---
## Índice

.text_80[
- **Introducción a R y la investigación reproducible:** 
  - Software estadístico e investigación
  - Introducción a R y RStudio: interfaz para programar en R o entorno de desarrollo integrado IDE, ventajas/desventajas 
  - Instalación
  - Proyectos en R, configurarlo, guardar conjuntos de datos, lógica de directorio (códigos, referencias, salidas de código, figuras), convenciones y buenas prácticas para guardar y abrir datos.
  - Recursos en línea
  - Inteligencia artificial
- **Carga de datos**
  - Qué es una función y un paquete
  - Bases de datos (formatos, pro y contras), Estructura de datos (identificar, variables y niveles de medición, valores)
  - Funciones y usos básicos en R: operadores, objetos, funciones, vectores, data.frames, estructura de funciones y estructuras de control
- **Tidyverse**
  - Ventajas y desventajas, gramática, operadores, aplicación
  - Manejo de datos: select, group_by, summarize, transmute, join
- **Exploración de datos**
  - Medidas de tendencia central, dispersión, posición y forma
  - Tablas de resumen
  - Visualización básica de datos (ej., histogramas, diagramas de barras y de cajas)
- **Visualización de datos con ggplot2**
  - Gramática y lógica de capas
  - Buenas prácticas
  - Ejemplos
- **Introducción a RMarkdown y Quarto**
  - Reproducibilidad y aplicabilidad
  - Formatos
  - Estructura
  - Ventajas y desventajas de cada uno
- *(Extra: De ser posible, Aplicación en modelos de regresión en R)*

.center[
.black[
  **Siempre y cuando sea posible**
    ]
  ]
]   
???
*#_#_#_#_#_#_#_#_#_#_
**NOTA**
*#_#_#_#_#_#_#_#_#_#_

VII. 	FORMAS DE EVALUACIÓN
•	Generar al menos 1 pregunta a través de CANVAS en formato Stackoverflow (10%)
•	Generar al menos 1 pregunta en ChatGPT relacionado al uso del software R (10%)
•	Dos talleres prácticos desarrollados en grupos de máximo dos o tres personas, dependiendo del tamaño del curso (70%). 
Taller 1: Manejo de datos (35%).
Taller 2: Exploración de datos (35%).  
•	Participación en Clase (10%). Entendida como 2 preguntas de alternativas al final de cada sesión (10 en total, 5%) y respuesta a una pregunta aleatoria emitida por los profesores a lo largo de la sesión (ausencia injustificada = nota 1.0) (5%)
Todas las evaluaciones deberán ser sometidas en la fecha y hora indicada a través de la plataforma del curso. Considerando una escala de 1.0 a 7.0, la penalización por atraso no justificado es de 0.3 puntos por día sobre la nota obtenida, con un máximo de 10 días de retraso. Luego de los 10 días el/la estudiante será calificada/o con la nota mínima en dicha evaluación.

- Dicho esto, vamos al grano

---
class: partial-bg inverse center, middle

background-image: linear-gradient(45deg, #ABB0BF, #555555)
<!---#DD3333--->

<!---
#https://github.com/AGSCL/Clases_DTSE1008/raw/main/data2.csv
#https://github.com/AGSCL/Clases_DTSE1008/raw/main/barrial.csv
#https://github.com/AGSCL/Clases_DTSE1008/raw/main/Drogas%20y%20jovenes_2007.sav
#https://github.com/AGSCL/Clases_DTSE1008/raw/main/IPC.csv
#https://github.com/AGSCL/Curso_R/tree/master/0c963a043f92e3c567b6afb48d406df5a2f38f5c
#https://github.com/AGSCL/Curso_R/raw/master/0c963a043f92e3c567b6afb48d406df5a2f38f5c/ejercicio2.zip

#MENTI PARA ENCUESTAS
https://www.menti.com/alrq4rscmzbu

https://github.com/AGSCL/Clases_DTSE1008

https://drive.google.com/drive/folders/10Hj3nPbT2SN5DntWV_5L1ahDLoO_M8j8

H:/Mi unidad/Curso_UDP/2023/anotaciones_clases_2022.R
http://observatorio.ministeriodesarrollosocial.gob.cl/encuesta-social-covid19-cuarta-ronda
--->

## Partamos

---
## Software estadístico e Investigación

- Los software estadísticos son **necesarios** para realizar investigación cuantitativa
- Reducen considerablemente el **tiempo** que necesitamos para procesar, limpiar y analizar bases de datos
- No todos los software estadísticos se utilizan para investigación (Ej: Excel, Python)
- Generalmente se utiliza SPSS, STATA o R
- Cada software tiene sus ventajas y desventajas dependiendo de la tarea que necesitemos realizar

.center[
```{r Fig Meme1b, message=FALSE, warning=FALSE, cache=T, echo =F, out.width = "450px"}
knitr::include_graphics("_figs/software_seen_by_others.png")
```
]
???
*#_#_#_#_#_#_#_#_#_#_
**NOTA**
*#_#_#_#_#_#_#_#_#_#_
- Lenguaje de programación desarrollado por estadísticos para estadísticos. 
- Python es de programación general, en contraste.
- Gratis y de código abierto (vs. otros paquetes que hay que comprar módulos)

---
## R y RStudio

.center[
.red[
  **A la hora de elegir qué utilizará, debe considerar estos atributos**
]
]
.pull_left[
- Flexible
- Actualizaciones constantes
- Fácil automatización e integración 
- Muchos recursos en-línea y comunidades
- Útil para ser enseñado a estudiantes
- Investigación Reproducible
- **Gratis** - Fuente Abierta
- Permite ver "tras bambalinas"

```{r Fig Meme2, message=FALSE, warning=FALSE, cache=T, echo =F, out.width = "450px"}
knitr::include_graphics("./_figs/consola.png")
```

]
.pull_right[
- No tan intuitivo
- No tan confiable 
- A ratos muy flexible
- No cuenta con soporte oficial
- Requiere tiempo 

```{r Fig Meme12, message=FALSE, warning=FALSE, cache=T, echo =F, out.width = "200px"}
knitr::include_graphics("https://github.com/AGSCL/Curso_R/raw/master/meme_sintaxis.jpg")
```
]

???
*#_#_#_#_#_#_#_#_#_#_
**NOTA**
*#_#_#_#_#_#_#_#_#_#_
- Flexibilidad (muchos diseños de datos y muchas funciones), Actualizaciones constantes (nuevos paquetes), de fácil automatización e integración con otras plataformas, software y lenguajes (Google, Excel, SQL, Stata, Python, etc.), muchos recursos en-línea (memes) y comunidades virtuales y presenciales (Rladies, useRchile, etc.), útil para ser enseñado a estudiantes y personas no tan familiarizadas con programación, **gratis**.
- No tan intuitivo (Difícil aprender sintaxis de R, incorporar lenguaje y lógica detrás), No tan confiable (Paquetes Obsoletos, Erróneos, No Compatibles), a ratos muy flexible (requiere especificar muchos parámetros, argumentos, opciones, etc.), requiere tiempo.
- Por ejemplo renv, o checkpoint o packrat, permiten tener un control total de los paquetes utilizados y su versión.
- No te entrega las cajitas con las opciones prefijadas. Permite entender qué hay detrás

---
## Ventajas/Desventajas de RStudio

.pull_left[
- **Entorno de Desarrollo Integrado para R**
- Control de versiones
- Paneles múltiples
- Permite automatizar algunas funciones de R (Knitr)
- Fácil Depurador (errores)
- Eficienta Recursos Computacionales
- Cuenta con soporte, versiones en servidor y grandes desarrolladores
]
.pull_right[
- Algo inestable en determinadas tareas es (Ej. "*Figure margins too large*")
- Tareas exigentes computacionalmente pueden ser más lentas
]

???
*#_#_#_#_#_#_#_#_#_#_
**NOTA**
*#_#_#_#_#_#_#_#_#_#_
Por ejemplo, control de versones con github y svn.
- Rstudio ventajas: Hay varios shortcuts de teclado, indicadores visuales para comandos, texto predictivo y auto-relleno de paréntesis, etc.


---
## Ventajas/Desventajas de RStudio (2)

.pull-left[
```{r Fig-Meme-excel, message=FALSE, warning=FALSE, cache=T, echo =F, out.width = "400px"}
knitr::include_graphics("_figs/excel_error.jpeg")
```

]


.pull-right[
```{r Fig Memecosa-chata, message=FALSE, warning=FALSE, cache=T, echo =F, out.width = "300px"}
knitr::include_graphics("_figs/haciendo_graf_excel-ezgif.com-crop.gif")
```
```{r Fig advertencias, message=FALSE, warning=FALSE, cache=T, echo =F, out.width = "300px"}
knitr::include_graphics("_figs/advertencias.jpg")
```
]

---
## Instalación

- En la página pudieron ver cómo se instalaba R, **¿Alguna duda?**

- Problemas frecuentes:
  - Microsoft R vs. R, Arquitectura SO (64bits vs. 32bits),
  
  - Conectar al servidor de repositorios (firewall, puertas de enlace bloqueadas, permisos de administrador, etc.),
  
  - **y un montón de cosas que se resuelven leyendo en internet.**
  
  - Ver el siguiente [ENLACE](proyecto.html)

---
## Entorno/Espacio de Trabajo

- Oprima `Cntrl + Alt + Shift 0`
<div class="yellow">- Editor de texto o códigos (ACTUALIZACION: Editor Visual Markdown)</div>
<div class="green">- Lugar de trabajo (objetos creados, funciones, historial, control de versiones) (ACTUALIZACION: Se agregó Tutorial)</div>
<div class="red">- Consola para desplegar los comandos y obtener resultados</div>
<div class="blue">- Multitabla (gráficos, carpetas, paquetes, visor páginas web) (ACTUALIZACION: Se agregó "Presentation")</div>

```{r Fig Entorno, fig.align="center", message=FALSE, warning=FALSE, cache=T, eval=F, echo =F, out.width = "700px"}
#knitr::include_graphics("./_figs/Entorno de Trabajo.PNG")
image_colorize(image_read(path = "https://github.com/AGSCL/Taller-UDP-2022/raw/main/_figs/entorno_de_trabajo.PNG"),15,"red")
```

```{r Fig-ent, fig.align="center", message=FALSE, warning=FALSE, cache=T, echo =F, out.width = "750px"}

# Now call back the plot
background <- image_read("_figs/entorno_de_trabajo.png")
# And bring in a logo
logo_raw <- image_read("https://i.imgur.com/e1IneGq.jpg") 

frames <- lapply(logo_raw, function(frame) {
  image_composite(background, frame, offset = "+70+800")
})

animation <- image_animate(image_join(frames))
animation

#image_write(animation, "_figs/dir_Travolta.gif")
```

???
*#_#_#_#_#_#_#_#_#_#_
**NOTA**
*#_#_#_#_#_#_#_#_#_#_
Comentarios:
- Cntrl+ Shift +H : Paara definir el entorno de trabajo.//Cmd + D: Para cambiar el entorno de trabajo
- Editor de sintaxis: Formato block de notas, no ejecuta la sintaxis, comentarios se agregan anteponiendo el signo gato, puede predecir comandos, se ejecuta con cntrl+enterp "run"
- Consola y visor resultados: Con un enter se ejcutarán, cambiarán de color una vez ejecutados, los errores arrojarán mensajes, ejecutar operaciones no es lo mismo que guardarlas, se ejecuta cuando hay un signo ">", no hay un mensaje de stop en la esquina superior derecha.
- Entorno de trabajo: Memoria interna programa y uso de memoria RAM, entorno de trabajo temporal, objetos almacenados.
- Visualizador: permite acceder a CRAN, manuales, etc.

- Cuando R está listo para recibir comandos veremos que en la consola aparece el símbolo `>` (llamado _prompt_ en la consola). 
- Para que R ejecute un comando debemos escribirlo al lado derecho del _prompt_ y apretar la tecla "Enter". Si en lugar del _prompt_ vemos el símbolo `+` significa que el comando entregado no estaba completo. 
- Un comando puede estar incompleto por distintas razones, aunque en general se debe a que se nos ha olvidado cerrar algún paréntesis en el comando entregado.

---
## Entorno de Trabajo (2)

- Rstudio permite crear un **Proyecto** (.Rproj), agrupa a todos los elementos. Puede gestionar los proyectos aquí:

```{r Fig rproj, fig.align="center", message=FALSE, warning=FALSE, cache=T, echo =F, out.width = "250px"}
#, out.width = "250px"
knitr::include_graphics("./_figs/rproj.png")
```

- **Directorio:** Ubicación en la que alojaré archivos que formarán parte del entorno de trabajo. Se obtiene mediante `getwd()`. **Configurarlo es muy importante (`setwd([RUTA])`).**
- **.rds:** Permite guardar bases de datos de manera individual (muy similar a una hoja excel, un archivo .csv, etc.)
- **.Rdata:** Permite guardar múltiples datos, objetos, funciones, etc., lo que equivale a decir que permite guardar el espacio de trabajo en general (`save.image(file =[RUTA])` para guardar todo, `save` para guardar sólo ciertos objetos en un .Rdata, `load([RUTA])` para restaurar). De igual forma, puede hacerlo desde aquí:

```{r Fig save_load_image, fig.align="center", message=FALSE, warning=FALSE, cache=T, echo =F, out.width = "250px"}
knitr::include_graphics("./_figs/guardar_load_rdata.png")
```

- **.R:** Una especie de archivos de texto en el que se pueden guardar comandos, anotaciones, etc. Similar a un archivo `.do` o sintaxis. Se recomienda que antes de cerrar una sesión, uno pueda guardar los scripts. **.Rdata no es lo mismo que .R, RECUÉRDELO**.

???
*#_#_#_#_#_#_#_#_#_#_
**NOTA**
*#_#_#_#_#_#_#_#_#_#_
PROYECTOS: que agrupa/incorpora los distintos elementos de más abajo. Se recomienda crear uno siempre que se trabaje en un proyecto de investigación nuevo. Además, se recomienda asignarle una carpeta de trabajo individual, que pueda estar respaldada constantemente (ojo: cuidado con Google Drive). 

- Igual uno puede guardar un solo archivo con `save(data_cons, file = "OUT/data3.RData")`



---

## LLM

.pull-left[
- **ROCEF** (Rol, Objetivo, Contexto, Ejemplo, Formato)

- **PROPER** (Rol [Persona], Solicitud[Request], Manera/Método[Operation], Presentación/Formato [Presentation], Ejemplo[Example], Retroalimentación[Refinement])

- **Jeff Su**: Task, Context, Exemplar, Persona, Format, Tone

- Usarlo como un proceso, no como producto

- Principios de calidad y precisión
]

.pull-right[

```{r Fig chatgptmeme, fig.align="center", message=FALSE, warning=FALSE, cache=T, echo =F, out.width = "250px"}
knitr::include_graphics("./_figs/chatgpt_meme.jpg")
```
]
.panelset[ .panel[.panel-name[1]
No es necesario ser cortés con un modelo de lenguaje.
Omite frases como “por favor”, “si no te importa”, “gracias”, etc.
Ve directo al punto. ]

.panel[.panel-name[2]
Integra a la audiencia prevista en el prompt.
Especifica si la audiencia es experta en el tema. ]

.panel[.panel-name[3]
Desglosa tareas complejas.
Divide las tareas complejas en una secuencia de prompts más simples. ]

.panel[.panel-name[4]
Usa directivas afirmativas.
Utiliza palabras como "haz", evitando el uso de lenguaje negativo. ]

.panel[.panel-name[5]
Pide explicaciones claras.
Cuando necesites aclaraciones, utiliza prompts como:
"Explica [tema específico] en términos simples." ]

.panel[.panel-name[6]
Añade incentivos para mejores soluciones.
Agrega frases como “¡Voy a dar una propina de $xxxx por una mejor solución!” ]

.panel[.panel-name[7]
Implementa ejemplos en los prompts.
Utiliza prompts con ejemplos claros (Few-shot prompting). ]

.panel[.panel-name[8]
Estructura tu prompt de forma clara.
Comienza con '###Instrucción###', seguido de ‘###Ejemplo###’. ]

.panel[.panel-name[9]
Incorpora frases específicas.
Usa las frases “Tu tarea es” y “Debes”. ]

.panel[.panel-name[10]
Incorpora consecuencias.
Utiliza la frase “Serás penalizado”. ]

.panel[.panel-name[11]
Humaniza las respuestas.
Incorpora la frase "Responde de manera natural y humana". ]

.panel[.panel-name[12]
Guiar el proceso de pensamiento.
Utiliza palabras como “desarrolla paso a paso” en tus prompts. ]

.panel[.panel-name[13]
Garantiza la imparcialidad.
Añade la frase "Asegúrate de que tu respuesta sea imparcial". ]

.panel[.panel-name[14]
Permite que el modelo te haga preguntas.
Deja que el modelo solicite detalles precisos preguntando hasta obtener la información necesaria. ]

.panel[.panel-name[15]
Prueba y refuerza tu comprensión.
Usa la frase: “Enséñame [nombre del teorema/tema/regla] e incluye una prueba al final.” ] 

.panel[.panel-name[16]
Asigna roles al modelo.
Establece un rol específico para el modelo de lenguaje en la tarea. ]

.panel[.panel-name[17]
Usa delimitadores.
Utiliza delimitadores claros para organizar la información. ]

.panel[.panel-name[18]
Repite frases clave.
Repite una palabra o frase específica varias veces dentro de un prompt. ]

.panel[.panel-name[19]
Combina Chain-of-Thought (CoT) [cadena de pensamiento, paso a paso] con Few-Shot [ejemplos] ]

.panel[.panel-name[20]
Usa primicias de salida.
Finaliza tu prompt con el comienzo de la respuesta esperada. ]

.panel[.panel-name[21]
Solicita textos detallados.
Utiliza: “Escribe un [ensayo/texto/párrafo] detallado sobre [tema] añadiendo toda la información necesaria”. ]

.panel[.panel-name[22]
Corrige sin cambiar el estilo.
Para corregir o cambiar texto sin modificar su estilo: “Revisa cada párrafo, sólo mejora gramática y vocabulario.” ]

.panel[.panel-name[23]
Manejo de prompts de codificación complejos.
"De ahora en adelante, cada vez que generes código que abarque más de un archivo, genera un script en [lenguaje]". ]

.panel[.panel-name[24]
Completa textos con palabras específicas. "Te proporcionaré el comienzo (letra de canción/historia/párrafo/ensayo) (Insertar letra/palabras/oración).” )]

.panel[.panel-name[25]
Especifica los requisitos claramente.
Indica claramente los requisitos que el modelo debe seguir. ]

.panel[.panel-name[26]
Escribe textos similares a un ejemplo.
“Por favor, utiliza el mismo lenguaje basado en el párrafo proporcionado.” ]

]


???
*#_#_#_#_#_#_#_#_#_#_
**NOTA**
*#_#_#_#_#_#_#_#_#_#_

- Joseph Weizenbaum, creador de ELIZA dice que una máquina hará lo que tu le digas que haga, aunque puede ser muy distinto a lo que imaginabas.

- LLM = Large Language Model
- Token = Las tareas se quiebran en paquetes pequeños o chunks. El previo da información al siguiente, que mejora la respuesta.
- Context length= Costo computacional (por extensión, contexto o complejidad). Por ejemplo, hace un tiempo leí una publicación que dice que es más caro hacer preguntas en no-inglés (enlace)[https://towardsdatascience.com/why-openais-api-is-more-expensive-for-non-english-languages-553da4a1eecc]
- Prompt

RECOMENDACIONES A LO DRA POLO:
- Sea preciso
- Utilícelo para mejorar, no para hacer su trabajo
- No confíe ciegamente en sus resultados (verifique la validez y calidad de sus resultados)
- No ingrese datos sensibles (sin de-identificar o anonimizar)
- No lo utilice de manera de violar sus políticas (ej., no ingrese contenido que no es de su propiedad intelectual)

Rol: Analista de datos.
Objetivo: Escribir un script en R para filtrar datos.
Contexto: Tienes un conjunto de datos llamado ventas que contiene información sobre ventas de productos en diferentes regiones. Necesitas filtrar las ventas solo para la región "Sur".
Ejemplo: "Quiero filtrar la tabla ventas para que solo muestre las filas donde la columna region es igual a 'Sur'."
Formato: El código en R debe estar en una sola línea.

Persona: Analista de datos.
Solicitud: Filtrar los datos para la región "Sur".
Método: Usar funciones básicas de R para filtrar.
Presentación: El código debe ser claro y en una sola línea.
Ejemplo: Puedes usar subset() o la notación con corchetes [ ].
Retroalimentación: Se espera que el código filtre correctamente la tabla ventas.

Task: Filtrar datos en R.
Context: Tienes una tabla llamada ventas y solo te interesan las ventas de la región 'Sur'.
Exemplar: Usa subset() o corchetes [ ] en R para lograr el filtrado.
Persona: Analista de datos trabajando con un gran conjunto de datos.
Format: El código debe ser conciso y eficiente, en una sola línea.
Tone: Profesional y directo.

---
## Tips/Recomendaciones

- `here::here()` permite saber cuál es la ubicación del directorio en vez de utilizar un directorio fijo.

- `rm(list = ls())` si bien puede ser útil, no empieza un proceso de R totalmente limpio, sino que elimina objetos creados en el espacio de trabajo. **TOTALMENTE RECOMENDADO**

- `renv()`, en un proyecto permite tener los paquetes de R actualizados hasta cierta fecha, junto con sus dependencias (snapshot)

- `dateback()` para instalar paquetes de acuerdo a su publicación en CRAN en una fecha

- `rstudioapi::getSourceEditorContext()$path`, permite también tener una ubicación relativa de su proyecto.

- `GitHub`, control de versiones, colaboración, etc.

.pull-left[
```{r Fig r-script-tip, fig.align="center", message=FALSE, warning=FALSE, cache=T, echo =F, out.width = "350px"}
knitr::include_graphics("./_figs/DQugFIWUEAErq0D.jpg")
```
]
.pull-right[
- Vea las opciones de su proyecto

```{r Fig open_save_load_script, fig.align="center", message=FALSE, warning=FALSE, cache=T, echo =F, out.width = "350px"}
knitr::include_graphics("./_figs/DQugFIWUEAErq0D.jpg")
```
]

???
*#_#_#_#_#_#_#_#_#_#_
**NOTA**
*#_#_#_#_#_#_#_#_#_#_
PROYECTOS: 

- Uno ve cuándo actualiza RENV (sus paquetes etc). Aunque es medio inestable, creo que es una gran opción.
- 


---
## Tips/Recomendaciones (2)

**¿Cómo preguntar algo en R?**

.pull_c[

- Stackoverflow, twitter, grupos en R
- `dput()` base de datos hipotética o real*
- Markdown
- Precisión
- Chat GPT Prompts

```{r Fig load-meme-jpeg, fig.align="center", message=FALSE, warning=FALSE, cache=T, echo =F, out.width = "250px"}
knitr::include_graphics("./_figs/meme_r_exp.jpeg")
```

]

???
*#_#_#_#_#_#_#_#_#_#_
**NOTA**
*#_#_#_#_#_#_#_#_#_#_

- Siempre antes busque en español e inglés si su pregunta fue planteada anteriormente (para que no la marquen como duplicada y reciba una mala calificación por flojo)

- Real siempre y cuando la desanonimice (`anonymizer`) o no sea la base de datos completa (filtre)

- `dput(mtcars)`: permite exportar la estructura de la base de datos para quien le ayude sepa cómo se ordenan sus datos y eventuales dependencias o clases de valores. Si bien puede apoyarse con una imagen de sus datos, es recomendable que use dput()

- Maneje algo de lenguaje markdown para hacer más entendible su pregunta

- No aburra, sea preciso. 

- Les dejo un ejemplo mío: https://stackoverflow.com/questions/63290366/mutate-across-multiple-variables-using-a-list-of-third-variables-in-r

- Otro en español: https://es.stackoverflow.com/questions/566778/loop-sobre-varios-objetos-con-nombres-parcialmente-com%c3%ban

- StackOverflow (https://es.stackoverflow.com/). Por ejemplo, Testeo de modelo lineal en R (https://es.stackoverflow.com/questions/331075/testeo-de-modelo-lineal-en-r)

- **Otros tips**: Incluya tags o palabres clave; revise con un compañere antes de publicar, responda adecuadamente al recibir retroalimentación, revise redacción, aunque en el título sea pragmático. Sea agradecido (upvote)


---
## Tips/Recomendaciones (3)

**Cursos**

- DataCamp. Por ejemplo, Introduction to R (https://www.datacamp.com/courses/free-introduction-to-r)

- Si usted quiere tener una prueba gratis de DataCamp, más allá de completar el primer capítulo de un curso (https://www.datacamp.com/blog/how-to-get-10-years-of-free-datacamp-if-youre-a-teacher-or-student)

- Statistics With Interactive R Learning(SWIRL): The easiest and the most interactive way to start learning R (https://swirlstats.com/students.html) [Youtube](https://youtu.be/w6L7Ye18yPE).

- edX. Por ejemplo, Dat Science: R Basics (https://www.edx.org/es/course/data-science-r-basics), o Introduction to R for Data Science (https://www.edx.org/es/course/introduction-to-r-for-data-science-2).

- YouTube. 

- Estación Lastarria (https://www.estacionlastarria.cl/actividades/rstudio/rstudio-ciencias-sociales.html)

- Centro de Microdatos UChile (https://www.microdatos.cl/analisis-datos-r)

- Introduction to R (https://www.quantargo.com/courses/course-r-introduction/)

**Comunidades**

-  R-Ladies (https://twitter.com/rladiessantiago)

- UseRChile Usuarios de R en Chile (https://userchile.cl/)

---
## Tips/Recomendaciones (4)


.pull-left[
**Otros**

- learnr (Etiqueta “Tutorial”)

- CheatSheets. https://rstudio.com/resources/cheatsheets/

- Memes

- Twitter, Pachá (@pachamaltese) y Hadley Wickham (@hadleywickham)

- Rpubs. Páginas alojadas que permiten ver cómo cada persona obtuvo un determinado producto a partir de un código

**IA**

- BARD (https://bard.google.com/?hl=es)

- AutoRegex (https://www.autoregex.xyz/)

- Rtutor (http://rtutor.ai/)

- ChatGPT (https://chat.openai.com/)
]

.pull-right[

```{r Fig experto-r-jpeg, fig.align="center", message=FALSE, warning=FALSE, cache=T, echo =F, out.width = "350px"}
knitr::include_graphics("./_figs/experto_r.jpg")
```

]

???
*#_#_#_#_#_#_#_#_#_#_
**NOTA**
*#_#_#_#_#_#_#_#_#_#_

- Por ejemplo, Estadística Útil (https://www.youtube.com/watch?v=rzw1E6HxBFY&list=PLfX5C7cc6LRJ7V6WNgatRQJ6PNMrb4zfM) Riffomonas Project  (https://www.youtube.com/c/RiffomonasProject), Population Data BC (https://www.youtube.com/channel/UCavuC5RfLRUv_8XZxYDR0FA), Econometrics, Causality, and Coding with Dr. HK (https://www.youtube.com/c/NickHuntingtonKlein), Sacha Epskamp (https://www.youtube.com/c/SachaEpskamp1), Paul Dickman (https://www.youtube.com/channel/UC0IZswgRCFX3FYagJ_-ODTg), NHSR Community (https://www.youtube.com/c/NHSRCommunity) Online Causal Inference Seminar (https://www.youtube.com/channel/UCiiOj5GSES6uw21kfXnxj3A)

**PEDIRLES QUE BAJEN DE GITHUB EL REPOSITORIO DE LAS CLASES**

---
## Ejemplo directorio trabajo de un proyecto

<button onclick="myFunction1()">Mostrar/esconder</button>

<div id="myDIV" style="display:none;">
.text_80[
```{r ej0, message=FALSE, warning=FALSE, echo=T}
#NULL (default) / TRUE (open) / FALSE (closed) 
path<-
list.files("./", full.names = TRUE, recursive = TRUE)

library(data.tree)
library(plyr)

a <- lapply(strsplit(path, "/"), function(z) as.data.frame(t(z)))
a <- rbind.fill(a)
mytree <- data.tree::as.Node(data.frame(pathString = path))
```
]
</div>
.text_80[
```{r}
mytree
```
]

???
*#_#_#_#_#_#_#_#_#_#_
**NOTA**
*#_#_#_#_#_#_#_#_#_#_
PROYECTOS: 

- Este es un proyecto que tiene una serie de carpetas, que se conecta a Github (control de versiones), etc.
- Esta es la estructura de datos que hay en su interior
- Veamos qué contiene: hay un "american-medical-association-10th-edition.csl", para insertar un formato de referencias
- Hay múltiples css para dar el estilo y diseño a la presentación y páginas en su interior
- Estan los .RMDs y los .HTMLs
- Carpetas: data, figs, output, style (ahí deberían ir los .css y todo lo que tiene relación con los temas, pero también van las fuentes de letra, etc.)
- Tips: cuidado con dejar las carpetas en una subcarpeta OneDrive o coordinada con la nube porque eso podría generar problemas de sincronización

---
## Ejercicio

- Parta un proyecto nuevo (con las consideraciones dichas)
- Tome las siguiente base de datos (copie y pegue en la consola):

<details>
.text_80[
```{r dput, message=FALSE, warning=FALSE, echo=T}
#importante poner asis para que no eche a perder la salida
data <- data.frame(
  Folio = c(1297, 986, 971, 949, 940, 1740, 1875, 1567, 699, 887, 1641, 964, 1635, 2084, 2047, 1310, 803, 1977, 1685, 1776, 1129, 1697, 1682, 1228),
  Curso = factor(c('5A', '5B', '5C', '5A', '5A', '5A', '5A', '5B', '5B', '5B', '5A', '5B', '5A', '5B', '5C', '5C', '5A', '5A', '5A', '5A', '5A', '5B', '5A', '5A')),
  Sexo = factor(c('F', 'F', 'F', 'F', 'F', 'F', 'M', 'F', 'M', 'M', 'F', 'M', 'M', 'F', 'F', 'F', 'F', 'F', 'M', 'F', 'F', 'F', 'M', 'F')),
  Peso = c(67.9, 43.9, 33.6, 33.2, 32.9, 26.2, 34.4, 36.6, 32.0, 52.2, 23.8, 40.6, 59.1, 33.4, 38.7, 41.8, 32.0, 35.8, 54.7, 67.3, 23.7, 44.2, 58.2, 43.7),
  Talla = c(158.0, 143.0, 147.0, 136.5, 138.0, 132.5, 141.0, 137.0, 136.5, 142.0, 132.5, 139.0, 141.0, 140.5, 141.5, 143.5, 140.0, 144.5, 153.0, 154.0, 133.0, 137.5, 143.0, 149.5),
  IMC = c(27.2, 21.5, 15.5, 17.8, 17.3, 14.9, 17.3, 19.5, 17.2, 25.9, 13.6, 21.0, 29.7, 16.9, 19.3, 20.3, 16.3, 17.1, 23.4, 28.4, 13.4, 23.4, 28.5, 19.6),
  zimc = c(2.146, 1.286, -0.756, 0.318, 0.110, -1.109, 0.221, 0.909, 0.228, 2.066, -2.101, 1.348, 2.396, 0.109, 0.767, 1.151, -0.373, -0.006, 1.791, 2.241, -2.176, 1.646, 2.318, 0.943),
  estado_zimc = c(3, 2, 0, 0, 0, 0, 0, 0, 0, 3, 1, 2, 3, 0, 0, 2, 0, 0, 3, 3, 1, 3, 3, 0),
  Clasifnut = factor(c('Obeso', 'Sobrepeso', 'Normal', 'Normal', 'Normal', 'Normal', 'Normal', 'Normal', 'Normal', 'Obeso', 'Bajo peso', 'Sobrepeso', 'Obeso', 'Normal', 'Normal', 'Sobrepeso', 'Normal', 'Normal', 'Obeso', 'Obeso', 'Bajo peso', 'Obeso', 'Obeso', 'Normal'))
)
```
]
</details>

.text_70[
```{r, results='asis'}
dput(data)
```
]

- Obtenga la media del `Peso`
- Guarde los pasos seguidos para utilizar la base de datos y el cálculo de la media (sintaxis)
- Guarde los resultados en un archivo
- Cerciórese de que se mantengan en la misma carpeta
- Cierre y reinicie su computador

???
*#_#_#_#_#_#_#_#_#_#_
**NOTA**
*#_#_#_#_#_#_#_#_#_#_
- Dos "comandos elementales" en R son las expresiones y las asignaciones. Las **expresiones** son comandos que R evalúa y cuyos resultados son impresos en la consola sin ser almacenados. Por ejemplo, el siguiente comando es una expresión porque solicita evaluar una suma cuyo resultado es arrojado a la consola:


---
## Ejercicio: Hágalo usted
- Su jefe le pide que vea los datos guardados en el proyecto de R adjunto en el enlace.

- Abra el siguiente [enlace](https://github.com/AGSCL/Taller-UDP-2022/raw/main/_data/ejercicio2.zip) y ubique el entorno de trabajo en una carpeta manipulable.

- Abra el **proyecto**, los datos, pero no el *script*

- Vea las primeras 6 filas del objeto `base_datos` 

- OPC. Vea las primeras 3 filas

- ¿A qué llegó?

```{r ej2, include=F}
##script, comentario
set.seed(112);base_datos<-data.frame(esto=rnorm(1:100))

head(base_datos) 
#1 -0.3142317
#2  2.4033751
#3 -0.7182640
#4 -1.7606110
#5 -1.1252812
#6 -0.7195406

head(base_datos,3)
# -0.3142317
#  2.4033751
# -0.7182640

head_base_datos<-capture.output(head(base_datos,3)) #capturamos lo que la consola nos entrega en un objeto
```

---
## Ejercicio: Hágalo usted (2)

- Cree un nuevo proyecto en R

- Genere la siguiente base de datos recurriendo a este código: `set.seed(6789); df2<- data.frame(numeros=round(rnorm(1:300)*100,0))`

- Utilizando `tail(df2)` obtenga las últimas 6 observaciones

- Súmelas

- ¿Llegó al siguiente número: `r set.seed(6789); df2<- data.frame(numeros=round(rnorm(1:300)*100,0));sum(tail(df2))`?

- OPC1 = obtenga la media de todos los números (use recursos en línea)

- OPC2 (+ avanzada)= obtenga el resultado usando comas como separador de decimales ("outdec" en internet)

- OPC3 = Obtenga la desviación estándar, separando los decimales con comas

- Guarde los datos y el proyecto

- Reinicie el computador. Vuelva a abrirlos

```{r hagalo_usted, include=F}
set.seed(6789); df2<- data.frame(numeros=round(rnorm(1:300)*100,0))

#Utilizando tail(df2) obtenga las últimas 6 observaciones. Súmelas
sum(tail(df2))

#OPC1 = obtenga la media de todos los números (use recursos en línea)
tail_df2<-tail(df2)

mean(tail_df2$numeros)

#OPC2 (+ avanzada)= obtenga el resultado usando comas como separador de decimales (“outdec” en internet)
options(OutDec= ",")
mean(tail_df2$numeros)

#OPC3 = Obtenga la desviación estandar, separando los decimales con comas
options(OutDec= ",")
sd(tail_df2$numeros)
```


???
*#_#_#_#_#_#_#_#_#_#_
**NOTA**
*#_#_#_#_#_#_#_#_#_#_
**Ejercicio: Hágalo con su compañere**
- En la carpeta `_data`, encontrará 2 ejercicios con nombre: **1a** y **1b**.
- Ejecute el .RMD, genere con él un proyecto y 
- Guarde la .Rdata con nombre 1a o 1b según corresponda (**NADA MÁS**)
- Compártalo con un compañere
- En aquel proyecto que le compartieron, sólo abra el .RData, despliegue el 
- resultado alojado en el objeto **"plot"**



---
## TAREA SUMATIVA

- Utilice SWIRL

.pull-left[
.text_80[

```{r, eval=F}
#Instala estos paquetes si no se encuentran instalados: "devtools", "bitops", "RCurl", "stringi", "httr", "swirl"
if (!require("devtools")) install.packages("devtools")
if (!require("bitops")) install.packages("bitops")
if (!require("RCurl")) install.packages("RCurl")
if (!require("stringi")) install.packages("stringi")
if (!require("httr")) install.packages("httr")
if (!require("swirl")) install.packages("swirl")
#install.packages("devtools", "bitops", "RCurl", "stringi", "httr", "swirl")
library(devtools)
library(bitops)
library(RCurl)
library(httr)
library(swirl)
set_config( config( ssl_verifypeer = 0L ) )
if (file.exists("/opt/R/home/library/swirl/Courses/Programando_en_R")) {
  uninstall_course("Programando_en_R")
}
install_course_github('josersosa','Programando_en_R')
select_language(language = "spanish")


#Empezamos con SWIRL
swirl()
```
  ]
]


.pull-left[

- Así inicia el curso

```{r Fig swirl1, fig.align="center", message=FALSE, warning=FALSE, cache=T, echo =F, out.width = "350px"}
knitr::include_graphics("./_figs/swirl_intro.png")
```

- Debe enviar esta captura de pantalla:

```{r Fig swirl2, fig.align="center", message=FALSE, warning=FALSE, cache=T, echo =F, out.width = "350px"}
knitr::include_graphics("./_figs/siwrl_captura.png")
```
]

???
*#_#_#_#_#_#_#_#_#_#_
**NOTA**
*#_#_#_#_#_#_#_#_#_#_

---
class: center, middle

# Gracias!

<br>
  
<div class="centered"> Contacto: CANVAS </div>

```{r, echo=FALSE,  fig.align="center", out.width=200, error=T}

knitr::include_graphics('./_figs/cringe_profe.png')

```



```{r, echo=FALSE,  fig.align="center", out.width=300, error=T}

knitr::include_graphics('./_style/cropped-logotipo_fsch.png')

```
<br>
  

---
## Fuentes

- Boccardo, Giorgio & Ruiz, Felipe. (2018). Uso de RStudio para Estadística Univariada en Ciencias Sociales. Manual de apoyo docente para la asignatura Estadística Descriptiva (1a. Edición). 10.13140/RG.2.2.32783.48803. https://github.com/feliperuizbruzzone/Uso-de-R-para-Estadistica-Social/blob/master/Boccardo%20%26%20Ruiz%20(2018).%20Uso%20de%20RStudio%20para%20Estad%C3%ADstica%20Univariada%20en%20Ciencias%20Sociales%20%5B19%20%20julio%5D.pdf

- Cano, E. & Moguerza, J. (2015). “R desde el principio. Curso ceRo de R”. Ediciones del Orto, Madrid. ISBN 84-7923-526-8. http://emilio.lcano.com/pub/cero/R-desde-el-principio-curso-cero-V1.02.pdf

-	Ozgur, C., Kleckner, M., & Li, Y. (2015). Selection of Statistical Software for Solving Big Data Problems. SAGE Open, 5(2), 215824401558437. doi:10.1177/2158244015584379

-	Leiden University (2023, April 12). “Goodbye SPSS, hallo R: ‘Now we can help students who like statistics to excel’”. Disponible en: https://www.universiteitleiden.nl/en/news/2023/04/goodbye-spss-hallo-r-now-we-can-help-students-who-like-statistics-to-excel

-	Elosua, P. (2009). ¿Existe vida más allá del SPSS? Descubre R. Psicothema, 21(4),652-655. ISSN: 0214-9915. Disponible en: http://www.psicothema.com/pdf/3686.pdf

- R Development Core Team (2000). Introducción a R. Notas sobre R: Un entorno de programación para Análisis de Datos y Gráficos. Versión 1.0.1
https://cran.r-project.org/doc/contrib/R-intro-1.1.0-espanol.1.pdf

- Bryan, J. (2017, Diciembre 12). Project-oriented workflow. https://www.tidyverse.org/blog/2017/12/workflow-vs-script/

- RStudio Support (2022, Octubre 16). Using RStudio Projects. https://support.rstudio.com/hc/en-us/articles/200526207-Using-Projects

- Stackoverflow. How do I ask a good question?. https://stackoverflow.com/help/how-to-ask

- Smit, R. (2023, April). Goodbye SPSS, hallo R: ‘Now we can help students who like statistics to excel’. Leiden University. Retrieved from https://www.universiteitleiden.nl/en/news/2023/04/goodbye-spss-hallo-r-now-we-can-help-students-who-like-statistics-to-excel.

```{r exp, eval=F, echo=F, include=F, results="asis"}

if(file.exists(gsub(".Rmd",".html",rstudioapi::getSourceEditorContext()$path))){
  library(pagedown)
  gsub(".Rmd",".html",rstudioapi::getSourceEditorContext()$path)
  #H:/Mi unidad/Curso_UDP/2024/Clase1.html
  #para exportar la presentación a PDF
  renderthis::to_pdf(from=gsub(".Rmd",".html",rstudioapi::getSourceEditorContext()$path),complex_slides = TRUE,to=gsub(".Rmd",".pdf",rstudioapi::getSourceEditorContext()$path), keep_intermediates=F)
  #xaringanBuilder::build_pdf(gsub(".Rmd",".Rmd",rstudioapi::getSourceEditorContext()$path),complex_slides = TRUE,output_file="pres_2023_23.pdf")
  
  library(pdftools)
  library(qpdf)
  library(digest)
  library(magick)
  
  remove_duplicate_pdf_slides <- function(input_pdf, output_pdf) {
      num_pages <- pdf_info(input_pdf)$pages
      
      # Initialize a vector to store the masked image hashes
      image_hashes <- character(num_pages)
      
      for (i in 1:num_pages) {
          # Render the page as an image
          page_image <- pdf_render_page(input_pdf, page = i, dpi = 72)
          
          # Convert raw bitmap to magick image for processing
          img <- image_read(page_image)
          
          # Mask the area where the page number is (bottom right corner)
          # Adjust the dimensions based on your page layout
          width <- image_info(img)$width
          height <- image_info(img)$height
          img <- image_crop(img, paste0(width, "x", height - 150, "+0+0")) # Crops out the bottom 50 pixels
          
          # Convert the cropped image to a format that can be hashed
          img_raw <- image_write(img, format = "png")
          
          # Hash the raw image data
          image_hashes[i] <- digest(img_raw, algo = "md5")
      }
      
      # Identify unique pages based on the masked image hash
      unique_indices <- which(!duplicated(image_hashes))
      
      # Create a temporary directory to store the individual unique pages
      temp_dir <- tempdir()
      temp_files <- file.path(temp_dir, paste0("page_", unique_indices, ".pdf"))
      
      # Extract the unique pages as separate PDFs
      for (i in seq_along(unique_indices)) {
          page_number <- unique_indices[i]
          pdf_subset(input_pdf, pages = page_number, output = temp_files[i])
      }
      
      # Combine the unique pages into a new PDF
      pdf_combine(input = temp_files, output = output_pdf)
      
      # Clean up temporary files
      file.remove(temp_files)
  }
  remove_duplicate_pdf_slides(sub(".Rmd",".pdf",rstudioapi::getSourceEditorContext()$path), gsub(".Rmd",".pdf",rstudioapi::getSourceEditorContext()$path))

} else{
  invisible("Todavía no se ha generado un PDF para exportar")
  }
```